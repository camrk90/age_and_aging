fcs_set<- read.flowSet(fcs_list, emptyValue = F, transformation = F)
fcs_comp<- compensate(fcs_set, comp_mtx)
rm(fcs_set)
ids<- lapply(sampleNames(fcs_comp), function(i) {fcs_comp@frames[[i]]@description[["$CELLS"]]})
ids<- do.call(rbind, ids)
ids<- make.unique(ids, sep = "_")
if(length(ids) != length(sampleNames(fcs_comp))) stop("new_names must match number of frames")
sampleNames(fcs_comp) <- ids
# optionally update phenoData column
pData(fcs_comp)$new_name <- sampleNames(fcs_comp)
return(fcs_comp)
}
#Read in all fcs files
fcs_19<- fcs_in(fcs_files19, comp_19)
library(tidyverse)
library(flowCore)
library(ggcyto)
library(umap)
#List all .fcs files for each year
fcs_files19<- list.files("/data/CEM/smacklab/cayo_flow_cytometry/Flow_Data_2019",
pattern = ".fcs", recursive = T, full.names = T)
fcs_files21<- list.files("/data/CEM/smacklab/cayo_flow_cytometry/Flow_Data_2021",
pattern = ".fcs", recursive = T, full.names = T)
fcs_files23<- list.files("/data/CEM/smacklab/cayo_flow_cytometry/Flow_Data_2023",
pattern = ".fcs", recursive = T, full.names = T)
fcs_files24<- list.files("/data/CEM/smacklab/cayo_flow_cytometry/Flow_Data_2024",
pattern = ".fcs", recursive = T, full.names = T)
#Read in compensation matrices
comp_files<- list.files("/home/ckelsey4/cayo_flow_data", pattern = ".csv", full.names=T)
comp_list<- lapply(comp_files, function(i){
mtx<- read.csv(i)
colnames(mtx)<- gsub("\\.", "-", colnames(mtx))
rownames(mtx)<- mtx[,1]
mtx<- mtx[,-1]
})
comp_19<- comp_list[[1]]
comp_21<- comp_list[[2]]
rm(comp_list)
fcs_list<- fcs_files19
comp_mtx<- comp_19
fcs_set<- read.flowSet(fcs_list, emptyValue = F, transformation = F)
fcs_comp<- compensate(fcs_set, comp_mtx)
?compensat3
?compensate
fix(compensate)
remove.packages("flowCore", lib = "~/R/x86_64-pc-linux-gnu-library/4.2")
BiocManager::install('flowCore')
BiocManager::install('flowCore')
BiocManager::install('flowCore')
library(flowCore)
fcs_comp<- compensate(fcs_set, comp_mtx)
remove.packages('flowCore')
BiocManager::install('flowCore')
detach("package:flowCore", unload = TRUE)
detach("package:ggcyto", unload = TRUE)
detach("package:flowCore", unload = TRUE)
detach("package:ncdfFlow", unload = TRUE)
#Load packages
library(tidyverse)
library(ggplot2)
#Load metadata
long_data<- read.table("/scratch/ckelsey4/Cayo_meth/long_data_adjusted.txt")
long_data<- long_data %>%
arrange(lid_pid) %>%
filter(n > 1)
#Load promoter methylation count matrices
promoter_methylation<- readRDS("/scratch/ckelsey4/Cayo_meth/prom_m_filtered")
#Subset list of matrices for autosomes and X-chromosome
promoter_methylation<- promoter_methylation[c(1:21)]
#Bind list elements into a dataframe
promoter_methylation<- do.call(rbind, promoter_methylation)
#Load promoter coverage matrices
promoter_coverage<- readRDS("/scratch/ckelsey4/Cayo_meth/prom_cov_filtered")
#Subset list of matrices for autosomes and X-chromosome
promoter_coverage<- promoter_coverage[c(1:21)]
#Bind list elements into a dataframe
promoter_coverage<- do.call(rbind, promoter_coverage)
#Match the lids (samples) between the metadata and methylation data
long_data<- long_data[long_data$lid_pid %in% colnames(promoter_coverage),]
promoter_methylation<- promoter_methylation[,colnames(promoter_methylation) %in% long_data$lid_pid]
promoter_coverage<- promoter_coverage[,colnames(promoter_coverage) %in% long_data$lid_pid]
View(long_data)
View(promoter_methylation)
View(promoter_coverage)
View(long_data)
#Plot age distribution
long_data %>%
ggplot(aes(x=age_at_sampling)) +
geom_histogram()
#Plot age distribution
long_data %>%
ggplot(aes(x=age_at_sampling, fill=individual_sex)) +
geom_histogram()
#Plot age distribution
long_data %>%
ggplot(aes(x=age_at_sampling, fill=individual_sex)) +
geom_histogram(colour="black")
#Plot age distribution
long_data %>%
ggplot(aes(x=age_at_sampling, fill=individual_sex)) +
geom_point()
#Plot age distribution
long_data %>%
ggplot(aes(x=age_at_sampling)) +
geom_point()
#Plot age distribution
long_data %>%
ggplot(aes(x=individual_sex, y=age_at_sampling)) +
geom_point()
View(promoter_coverage)
View(long_data)
#Plot age distribution
long_data %>%
ggplot(aes(x=age_at_sampling, fill=individual_sex)) +
geom_point()
library(tidyverse)
rna_meta_full<- readRDS("/home/ckelsey4/Cayo_meth/rna_seq/Cayo_PBMC_longLPS_metadata_wELA_18Jul25.rds")
rna_counts<- readRDS("/home/ckelsey4/Cayo_meth/rna_seq/Cayo_PBMC_longLPS_counts_18Jul25.rds")
rna_kin<- readRDS("/scratch/ckelsey4/Cayo_meth/rna_kin_matrix.rds")
View(rna_meta_full)
unique(rna_meta_full$trap_date)
unique(rna_meta_full$Trap_Year)
m_rna<- readRDS("/home/ckelsey4/data/metadata_Ashlee.rds")
View(m_rna)
BiocManager::install('monocle')
#List all .fcs files for each year
fcs_files19<- list.files("/data/CEM/smacklab/cayo_flow_cytometry/Flow_Data_2019",
pattern = ".fcs", recursive = T, full.names = T)
library(tidyverse)
library(flowCore)
library(ggcyto)
#Read in compensation matrices
comp_files<- list.files("/home/ckelsey4/cayo_flow_data", pattern = ".csv", full.names=T)
comp_list<- lapply(comp_files, function(i){
mtx<- read.csv(i)
colnames(mtx)<- gsub("\\.", "-", colnames(mtx))
rownames(mtx)<- mtx[,1]
mtx<- mtx[,-1]
})
comp_19<- comp_list[[1]]
comp_21<- comp_list[[2]]
rm(comp_list)
#Read in, compensate, and rename .fcs files by year
fcs_in<- function(fcs_list, comp_mtx){
fcs_set<- read.flowSet(fcs_list, emptyValue = F, transformation = F)
fcs_comp<- fsApply(fcs_set, function(ff) compensate(ff, comp_mtx))
rm(fcs_set)
ids<- lapply(sampleNames(fcs_comp), function(i) {fcs_comp@frames[[i]]@description[["$CELLS"]]})
ids<- do.call(rbind, ids)
ids<- make.unique(ids, sep = "_")
if(length(ids) != length(sampleNames(fcs_comp))) stop("new_names must match number of frames")
sampleNames(fcs_comp) <- ids
# optionally update phenoData column
pData(fcs_comp)$new_name <- sampleNames(fcs_comp)
return(fcs_comp)
}
#Read in all fcs files
fcs_19<- fcs_in(fcs_files19, comp_19)
cs<- fcs_19@frames[["04Z"]]
# Call it "e.matrix" i.e., expression matrix so that I can copy-paste code, but dimensions are flow gates instead of expressed genes
e.matrix = exprs(fcs)
fcs<- fcs_19@frames[["04Z"]]
# Call it "e.matrix" i.e., expression matrix so that I can copy-paste code, but dimensions are flow gates instead of expressed genes
e.matrix = exprs(fcs)
# Instead of cell IDs, the columns are "events"
rownames(e.matrix) = paste0('event',formatC(seq_len(nrow(e.matrix)),width=8,flag=0))
e.matrix<- e.matrix[, 5:14]
# Drop forward scatter < 225 and and values for FSC or SSC that are 1000 (the maximum)
e.gated = e.matrix[e.matrix[,'FSC-A'] >= 225 & e.matrix[,'FSC-A'] < 1000 & e.matrix[,'SSC-A'] < 1000,]
# Scale data
e.scaled = scale(e.gated)[,grep('^FSC-A$',colnames(e.gated)):ncol(e.gated)]
# Load monocle and treat this as mock single-cell RNAseq data
library(monocle)
expression.data = t(e.scaled)
cell.metadata = data.frame(cell_name = colnames(expression.data))
rownames(cell.metadata) = colnames(expression.data)
gene.metadata = data.frame(gene_short_name = rownames(expression.data))
rownames(gene.metadata) = rownames(expression.data)
View(gene.metadata)
View(cell.metadata)
cds = new_cell_data_set(expression.data,cell.metadata,gene.metadata)
cds = newCellDataSet(expression.data,cell.metadata,gene.metadata)
fix(newCellDataSet())
fix(newCellDataSet)
View(expression.data)
View(e.gated)
View(cell.metadata)
source("~/.active-rstudio-document", echo = TRUE)
remotes::install_github("bnprks/BPCells/r")
remotes::install_github("bnprks/BPCells/r")
install.packages('BPCells', repos = c('https://bnprks.r-universe.dev', 'https://cloud.r-project.org'))
devtools::install_github("thomasp85/patchwork")
install.packages('patchwork')
install.packages('ggplot2')
install.packages('patchwork')
install.packages('BPCells', repos = c('https://bnprks.r-universe.dev', 'https://cloud.r-project.org'))
library(tidyverse)
library(flowCore)
BiocManager::install('flowCore')
install.packages('BPCells', repos = c('https://bnprks.r-universe.dev', 'https://cloud.r-project.org'))
devtools::install_github('cole-trapnell-lab/monocle3')
Sys.getenv("GITHUB_PAT")
usethis::create_github_token()
gitcreds::gitcreds_set()
Sys.getenv("GITHUB_PAT")
gitcreds_get()
gitcreds::gitcreds_get()
gitcreds::gitcreds_get()
gitcreds::gitcreds_set()
devtools::install_github('cole-trapnell-lab/monocle3')
Sys.getenv("GITHUB_PAT")
devtools::install_github('cole-trapnell-lab/monocle3')
Sys.getenv("GITHUB_PAT")
devtools::install_github('cole-trapnell-lab/monocle3')
Sys.getenv("GITHUB_PAT")
library(tidyverse)
library(flowCore)
library(ggcyto)
BiocManager::install('ggcyto')
library(ggcyto)
library(umap)
#List all .fcs files for each year
fcs_files19<- list.files("/data/CEM/smacklab/cayo_flow_cytometry/Flow_Data_2019",
pattern = ".fcs", recursive = T, full.names = T)
fcs_files21<- list.files("/data/CEM/smacklab/cayo_flow_cytometry/Flow_Data_2021",
pattern = ".fcs", recursive = T, full.names = T)
fcs_files23<- list.files("/data/CEM/smacklab/cayo_flow_cytometry/Flow_Data_2023",
pattern = ".fcs", recursive = T, full.names = T)
fcs_files24<- list.files("/data/CEM/smacklab/cayo_flow_cytometry/Flow_Data_2024",
pattern = ".fcs", recursive = T, full.names = T)
#Read in compensation matrices
comp_files<- list.files("/home/ckelsey4/cayo_flow_data", pattern = ".csv", full.names=T)
comp_list<- lapply(comp_files, function(i){
mtx<- read.csv(i)
colnames(mtx)<- gsub("\\.", "-", colnames(mtx))
rownames(mtx)<- mtx[,1]
mtx<- mtx[,-1]
})
comp_19<- comp_list[[1]]
comp_21<- comp_list[[2]]
rm(comp_list)
#Read in, compensate, and rename .fcs files by year
fcs_in<- function(fcs_list, comp_mtx){
fcs_set<- read.flowSet(fcs_list, emptyValue = F, transformation = F)
fcs_comp<- fsApply(fcs_set, function(ff) compensate(ff, comp_mtx))
rm(fcs_set)
ids<- lapply(sampleNames(fcs_comp), function(i) {fcs_comp@frames[[i]]@description[["$CELLS"]]})
ids<- do.call(rbind, ids)
ids<- make.unique(ids, sep = "_")
if(length(ids) != length(sampleNames(fcs_comp))) stop("new_names must match number of frames")
sampleNames(fcs_comp) <- ids
# optionally update phenoData column
pData(fcs_comp)$new_name <- sampleNames(fcs_comp)
return(fcs_comp)
}
#Read in all fcs files
fcs_19<- fcs_in(fcs_files19, comp_19)
fcs<- fcs_19@frames[["04Z"]]
# Call it "e.matrix" i.e., expression matrix so that I can copy-paste code, but dimensions are flow gates instead of expressed genes
e.matrix = exprs(fcs)
# Instead of cell IDs, the columns are "events"
rownames(e.matrix) = paste0('event',formatC(seq_len(nrow(e.matrix)),width=8,flag=0))
e.matrix<- e.matrix[, 5:14]
# Drop forward scatter < 225 and and values for FSC or SSC that are 1000 (the maximum)
e.gated = e.matrix[e.matrix[,'FSC-A'] >= 225 & e.matrix[,'FSC-A'] < 1000 & e.matrix[,'SSC-A'] < 1000,]
# Scale data
e.scaled = scale(e.gated)[,grep('^FSC-A$',colnames(e.gated)):ncol(e.gated)]
# Load monocle and treat this as mock single-cell RNAseq data
library(monocle)
# Load monocle and treat this as mock single-cell RNAseq data
library(monocle3)
expression.data = t(e.scaled)
options(stringsAsFactors=FALSE)
cell.metadata = data.frame(cell_name = colnames(expression.data))
rownames(cell.metadata) = colnames(expression.data)
gene.metadata = data.frame(gene_short_name = rownames(expression.data))
rownames(gene.metadata) = rownames(expression.data)
cds = new_cell_data_set(expression.data,cell.metadata,gene.metadata)
cds = preprocess_cds(cds)
View(cds)
View(expression.data)
fcs_files19
fcs = read.FCS(paste(flow_path, "Flow_Data_2019/Cayo Santiago Week 3 (Oct-Nov 28-1)/2019-11-01/04Z2019-11-01.0001.fcs",
sep = ""),emptyValue=FALSE,transformation=FALSE)
flow_path="/data/CEM/smacklab/cayo_flow_cytometry/"
fcs = read.FCS(paste(flow_path, "Flow_Data_2019/Cayo Santiago Week 3 (Oct-Nov 28-1)/2019-11-01/04Z2019-11-01.0001.fcs",
sep = ""),emptyValue=FALSE,transformation=FALSE)
View(fcs)
# Call it "e.matrix" i.e., expression matrix so that I can copy-paste code, but dimensions are flow gates instead of expressed genes
e.matrix = exprs(fcs)
# Call it "e.matrix" i.e., expression matrix so that I can copy-paste code, but dimensions are flow gates instead of expressed genes
e.matrix = exprs(fcs)
View(fcs)
# Call it "e.matrix" i.e., expression matrix so that I can copy-paste code, but dimensions are flow gates instead of expressed genes
e.matrix = fcs@exprs
# Instead of cell IDs, the columns are "events"
rownames(e.matrix) = paste0('event',formatC(seq_len(nrow(e.matrix)),width=8,flag=0))
e.matrix<- e.matrix[, 5:14]
View(e.matrix)
# Drop forward scatter < 225 and and values for FSC or SSC that are 1000 (the maximum)
e.gated = e.matrix[e.matrix[,'FSC-A'] >= 225 & e.matrix[,'FSC-A'] < 1000 & e.matrix[,'SSC-A'] < 1000,]
# Scale data
e.scaled = scale(e.gated)[,grep('^FSC-A$',colnames(e.gated)):ncol(e.gated)]
# Load monocle and treat this as mock single-cell RNAseq data
library(monocle3)
expression.data = t(e.scaled)
options(stringsAsFactors=FALSE)
cell.metadata = data.frame(cell_name = colnames(expression.data))
rownames(cell.metadata) = colnames(expression.data)
gene.metadata = data.frame(gene_short_name = rownames(expression.data))
rownames(gene.metadata) = rownames(expression.data)
cds = new_cell_data_set(expression.data,cell.metadata,gene.metadata)
View(expression.data)
View(e.matrix)
# Drop forward scatter < 225 and and values for FSC or SSC that are 1000 (the maximum)
e.gated = e.matrix[e.matrix[,'FSC-A'] >= 225 & e.matrix[,'FSC-A'] < 1000 & e.matrix[,'SSC-A'] < 1000,]
# Scale data
e.scaled = scale(e.gated)[,grep('^FSC-A$',colnames(e.gated)):ncol(e.gated)]
View(e.scaled)
expression.data = t(e.scaled)
options(stringsAsFactors=FALSE)
cell.metadata = data.frame(cell_name = colnames(expression.data))
rownames(cell.metadata) = colnames(expression.data)
gene.metadata = data.frame(gene_short_name = rownames(expression.data))
rownames(gene.metadata) = rownames(expression.data)
cds = new_cell_data_set(expression.data,cell.metadata,gene.metadata)
View(cds)
cds = preprocess_cds(cds)
cds = reduce_dimension(cds)
cds = cluster_cells(cds)
View(expression.data)
plot_cells(cds,color_cells_by='cluster')
View(cds)
cds@clusters
colData(cds)
View(fcs)
head(fcs@description)
df<- do.call(rbind, fcs@description)
View(df)
View(e.matrix)
cds@colData@listData
colData(cds)
df<- colData(cds)
View(df)
df<- as.data.frame(colData(cds))
View(cell.metadata)
dim(e.matrix)
dim(e.scaled)
View(expression.data)
View(gene.metadata)
rm(df)
save.image("/home/ckelsey4/cayo_flow_data/flow_map.RData")
library(tidyverse)
library(ggplot2)
library(ggcorrplot)
library(ggvenn)
library(variancePartition)
library(lme4)
load("/scratch/ckelsey4/Cayo_meth/cross_within_compare.RData")
#Plot annotation proportions----------------------------------------------------
generate_proportion<- function(df, x){
d1<- df %>%
distinct(unique_cpg, .keep_all = T) %>%
group_by(anno_class, {{x}}) %>%
summarise(count = n()) %>%
mutate(perc = count/sum(count))
print(d1)
d2<- df %>%
distinct(unique_cpg, .keep_all = T) %>%
group_by({{x}}) %>%
summarise(count = n()) %>%
mutate(perc = count/sum(count))
d2$anno_class<- "All"
d3<- rbind(d1, d2)
annos2<- unique(d3$anno_class)
d3$anno_class<- factor(d3$anno_class, levels = annos2)
col1 <- eval(substitute(x), d2)
d3$percent<- d3$perc*100
d3 %>%
ggplot(aes(x = percent, y=anno_class, fill = factor({{x}}))) +
geom_bar(stat="identity", width = 0.7, colour="black") +
theme_classic(base_size=32) +
#geom_vline(xintercept = (1-d2$perc[col1 == "Age-Hypermethylated"])*100, linetype = 'dashed') +
#geom_vline(xintercept = d2$perc[col1 == "Age-Hypomethylated"]*100, linetype = 'dashed') +
#theme(legend.position = "none") +
#scale_fill_manual(values = c(c1, c2, c3)) +
ylab("Annotation") +
xlab("Percentage")
}
generate_proportion(pqlseq_anno, cross_signif, "steelblue2", "gray90", "steelblue4")
generate_proportion(pqlseq_anno, cross_signif)
#Plot annotation proportions----------------------------------------------------
generate_proportion<- function(df, x, c1, c2, c3){
d1<- df %>%
distinct(unique_cpg, .keep_all = T) %>%
group_by(anno_class, {{x}}) %>%
summarise(count = n()) %>%
mutate(perc = count/sum(count))
print(d1)
d2<- df %>%
distinct(unique_cpg, .keep_all = T) %>%
group_by({{x}}) %>%
summarise(count = n()) %>%
mutate(perc = count/sum(count))
d2$anno_class<- "All"
d3<- rbind(d1, d2)
annos2<- unique(d3$anno_class)
d3$anno_class<- factor(d3$anno_class, levels = annos2)
col1 <- eval(substitute(x), d2)
d3$percent<- d3$perc*100
d3 %>%
ggplot(aes(x = percent, y=anno_class, fill = factor({{x}}))) +
geom_bar(stat="identity", width = 0.7, colour="black") +
theme_classic(base_size=32) +
#geom_vline(xintercept = (1-d2$perc[col1 == "Age-Hypermethylated"])*100, linetype = 'dashed') +
#geom_vline(xintercept = d2$perc[col1 == "Age-Hypomethylated"]*100, linetype = 'dashed') +
#theme(legend.position = "none") +
scale_fill_manual(values = c(c1, c2, c3)) +
ylab("Annotation") +
xlab("Percentage")
}
generate_proportion(pqlseq_anno, cross_signif, "steelblue2", "gray90", "steelblue4")
generate_proportion(pqlseq_anno, within_signif, "purple4", "gray90", "purple1")
#Plot annotation proportions----------------------------------------------------
generate_proportion<- function(df, x, c1, c2, c3){
d1<- df %>%
distinct(unique_cpg, .keep_all = T) %>%
group_by(anno_class, {{x}}) %>%
summarise(count = n()) %>%
mutate(perc = count/sum(count))
print(d1)
d2<- df %>%
distinct(unique_cpg, .keep_all = T) %>%
group_by({{x}}) %>%
summarise(count = n()) %>%
mutate(perc = count/sum(count))
d2$anno_class<- "All"
d3<- rbind(d1, d2)
annos2<- unique(d3$anno_class)
d3$anno_class<- factor(d3$anno_class, levels = annos2)
col1 <- eval(substitute(x), d2)
d3$percent<- d3$perc*100
d3 %>%
ggplot(aes(x = percent, y=anno_class, fill = factor({{x}}))) +
geom_bar(stat="identity", width = 0.7, colour="black") +
theme_classic(base_size=32) +
geom_vline(xintercept = (1-d2$perc[col1 == "Age-Hypermethylated"])*100, linetype = 'dashed') +
geom_vline(xintercept = d2$perc[col1 == "Age-Hypomethylated"]*100, linetype = 'dashed') +
#theme(legend.position = "none") +
scale_fill_manual(values = c(c1, c2, c3)) +
ylab("Annotation") +
xlab("Percentage")
}
generate_proportion(pqlseq_anno, chron_signif, "darkgoldenrod4", "gray90", "darkgoldenrod1")
within_enrich<- enrichment(pqlseq_anno, "Within Age Significant")
enrichment<- function(model_df, cross_type, var_type){
df_list<- list()
for(i in unique(model_df$anno_class)) {
df2<- model_df %>%
distinct(unique_cpg, .keep_all = T)
df3<- model_df %>%
distinct(unique_cpg, .keep_all = T) %>%
filter(!unique_cpg %in% df2$unique_cpg)
#Counts for fdr < 0.05 & cpg is Within Positive, Cross Negative
a<- nrow(df2[df2[[cross_type]] == var_type & df2$anno_class == i,])
b<- nrow(df2[df2[[cross_type]] == var_type & df2$anno_class != i,])
#Counts for NOT fdr < 0.05 & cpg is Within Positive, Cross Negative
c<- nrow(df2[df2[[cross_type]] != var_type & df2$anno_class == i,])
d<- nrow(df2[df2[[cross_type]] != var_type & df2$anno_class != i,])
#Generate contingency table
c_table<- data.frame("x" = c(a, b),
"y" = c(c, d),
row.names = c(paste(i, "Y", sep=""), paste(i, "N", sep="")))
colnames(c_table) = c(paste("Is", var_type), paste("Is", "NOT", var_type))
if (all.equal(sum(c_table), length(unique(model_df$unique_cpg)))){
print(paste("Contingency table sum for", i, "matches unique cpg_loc length"))
df_list[[length(df_list)+1]] = c_table
print(c_table)
}
}
#name table list
names(df_list)<- unique(model_df$anno_class)
#Fisher test for each table and tidy with broom
ft<- lapply(df_list, fisher.test)
ft<- lapply(ft, broom::tidy)
ft<- do.call(rbind, ft)
ft<- ft %>%
mutate(annotation = rownames(ft))
#FDR p-val adjustment
ft<- ft %>%
mutate(padj = p.adjust(p.value)) %>%
mutate_at(vars(annotation), as.factor)
#Log estimates and CIs
ft<- ft %>%
mutate(log_or = log(estimate),
log_ci.lo = log(conf.low),
log_ci.hi = log(conf.high))
ft$anno_source<- "Repeat Elements"
ft$anno_source[ft$annotation == "TSSs" | ft$annotation == "Active Tr." |
ft$annotation == "Enhancers" | ft$annotation == "Quiescent" |
ft$annotation == "Promoter"]<- "Transcription"
ft<- ft %>%
arrange(anno_source, log_or)
hyper_levels<- as.character(ft$annotation)
#Rearrange factors to sort by type then log_or
ft$annotation<- factor(ft$annotation, levels = rev(annos))
ft$type<- var_type
return(ft)
}
within_enrich<- enrichment(pqlseq_anno, "Within Age Significant")
within_enrich<- enrichment(pqlseq_anno, "within_chron", "Within Age Significant")
generate_proportion(pqlseq_anno, within_signif, "purple4", "gray90", "purple1")
