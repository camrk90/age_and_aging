annos2<- unique(d3$anno_class)
d3$anno_class<- factor(d3$anno_class, levels = annos2)
col1 <- eval(substitute(x), d2)
d3 %>%
ggplot(aes(x = perc*100, y=anno_class, fill = factor({{x}}))) +
geom_bar(stat="identity", width = 0.7, colour="black") +
#geom_text(label=df$count, hjust=-5) +
geom_vline(xintercept = (1-d2$perc[col1 == "Age-Hypermethylated"])*100, linetype = 'dashed') +
geom_vline(xintercept = d2$perc[col1 == "Age-Hypomethylated"]*100, linetype = 'dashed') +
theme_classic(base_size=32) +
#theme(legend.position = "none") +
#scale_fill_manual(values = c(c1, c2, c3)) +
ylab("Annotation") +
xlab("Percentage")
return(d3)
}
generate_proportion(pqlseq_anno, direction)
pqlseq_anno$direction[(pqlseq_anno$beta_within_age < 0 & pqlseq_anno$beta_long_cross < 0) &
(pqlseq_anno$fdr_within_age < .05 | pqlseq_anno$fdr_long_cross < .05)]<-"Both Negative"
pqlseq_anno$direction<- "Non-Significant"
pqlseq_anno$direction[(pqlseq_anno$beta_within_age < 0 & pqlseq_anno$beta_long_cross < 0) &
(pqlseq_anno$fdr_within_age < .05 | pqlseq_anno$fdr_long_cross < .05)]<-"Both Negative"
pqlseq_anno$direction[(pqlseq_anno$beta_within_age > 0 & pqlseq_anno$beta_long_cross > 0) &
(pqlseq_anno$fdr_within_age < .05 | pqlseq_anno$fdr_long_cross < .05)]<- "Both Positive"
pqlseq_anno$direction[(pqlseq_anno$beta_within_age < 0 & pqlseq_anno$beta_long_cross > 0) &
(pqlseq_anno$fdr_within_age < .05 | pqlseq_anno$fdr_long_cross < .05)]<- "Within Negative, Cross Positive"
pqlseq_anno$direction[(pqlseq_anno$beta_within_age > 0 & pqlseq_anno$beta_long_cross < 0) &
(pqlseq_anno$fdr_within_age < .05 | pqlseq_anno$fdr_long_cross < .05)]<- "Within Positive, Cross Negative"
generate_proportion(pqlseq_anno, direction)
#Plot annotation proportions----------------------------------------------------
generate_proportion<- function(df, x){
d1<- df %>%
distinct(unique_cpg, .keep_all = T) %>%
group_by(anno_class, {{x}}) %>%
summarise(count = n()) %>%
mutate(perc = count/sum(count))
print(d1)
d2<- df %>%
distinct(unique_cpg, .keep_all = T) %>%
group_by({{x}}) %>%
summarise(count = n()) %>%
mutate(perc = count/sum(count))
d2$anno_class<- "All"
d3<- rbind(d1, d2)
annos2<- unique(d3$anno_class)
d3$anno_class<- factor(d3$anno_class, levels = annos2)
col1 <- eval(substitute(x), d2)
d3 %>%
ggplot(aes(x = perc*100, y=anno_class, fill = factor({{x}}))) +
geom_bar(stat="identity", width = 0.7, colour="black") +
#geom_text(label=df$count, hjust=-5) +
geom_vline(xintercept = (1-d2$perc[col1 == "Age-Hypermethylated"])*100, linetype = 'dashed') +
geom_vline(xintercept = d2$perc[col1 == "Age-Hypomethylated"]*100, linetype = 'dashed') +
theme_classic(base_size=32) +
#theme(legend.position = "none") +
#scale_fill_manual(values = c(c1, c2, c3)) +
ylab("Annotation") +
xlab("Percentage")
return(d3)
}
generate_proportion(pqlseq_anno, direction)
#Plot annotation proportions----------------------------------------------------
generate_proportion<- function(df, x){
d1<- df %>%
distinct(unique_cpg, .keep_all = T) %>%
group_by(anno_class, {{x}}) %>%
summarise(count = n()) %>%
mutate(perc = count/sum(count))
print(d1)
d2<- df %>%
distinct(unique_cpg, .keep_all = T) %>%
group_by({{x}}) %>%
summarise(count = n()) %>%
mutate(perc = count/sum(count))
d2$anno_class<- "All"
d3<- rbind(d1, d2)
annos2<- unique(d3$anno_class)
d3$anno_class<- factor(d3$anno_class, levels = annos2)
col1 <- eval(substitute(x), d2)
return(d3)
}
df<- generate_proportion(pqlseq_anno, direction)
View(df)
df<- df %>%
mutate(percent = percent*100)
df<- df %>%
mutate(percent = perc*100)
View(df)
df %>%
ggplot(aes(x = percent, y=anno_class, fill = factor(direction))) +
geom_bar(stat="identity", width = 0.7, colour="black") +
theme_classic(base_size=32) +
#theme(legend.position = "none") +
#scale_fill_manual(values = c(c1, c2, c3)) +
ylab("Annotation") +
xlab("Percentage")
df %>%
ggplot(aes(x = perc*100, y=anno_class, fill = factor(direction))) +
geom_bar(stat="identity", width = 0.7, colour="black") +
theme_classic(base_size=32) +
#theme(legend.position = "none") +
#scale_fill_manual(values = c(c1, c2, c3)) +
ylab("Annotation") +
xlab("Percentage")
df$percent<- df$perc*100
View(df)
#Plot annotation proportions----------------------------------------------------
generate_proportion<- function(df, x){
d1<- df %>%
distinct(unique_cpg, .keep_all = T) %>%
group_by(anno_class, {{x}}) %>%
summarise(count = n()) %>%
mutate(perc = count/sum(count))
print(d1)
d2<- df %>%
distinct(unique_cpg, .keep_all = T) %>%
group_by({{x}}) %>%
summarise(count = n()) %>%
mutate(perc = count/sum(count))
d2$anno_class<- "All"
d3<- rbind(d1, d2)
annos2<- unique(d3$anno_class)
d3$anno_class<- factor(d3$anno_class, levels = annos2)
col1 <- eval(substitute(x), d2)
d3$percent<- d3$percent*100
d3 %>%
ggplot(aes(x = percent, y=anno_class, fill = factor({{x}}))) +
geom_bar(stat="identity", width = 0.7, colour="black") +
theme_classic(base_size=32) +
#geom_vline(xintercept = (1-d2$perc[col1 == "Age-Hypermethylated"])*100, linetype = 'dashed') +
#geom_vline(xintercept = d2$perc[col1 == "Age-Hypomethylated"]*100, linetype = 'dashed') +
#theme(legend.position = "none") +
#scale_fill_manual(values = c(c1, c2, c3)) +
ylab("Annotation") +
xlab("Percentage")
}
df<- generate_proportion(pqlseq_anno, direction)
#Plot annotation proportions----------------------------------------------------
generate_proportion<- function(df, x){
d1<- df %>%
distinct(unique_cpg, .keep_all = T) %>%
group_by(anno_class, {{x}}) %>%
summarise(count = n()) %>%
mutate(perc = count/sum(count))
print(d1)
d2<- df %>%
distinct(unique_cpg, .keep_all = T) %>%
group_by({{x}}) %>%
summarise(count = n()) %>%
mutate(perc = count/sum(count))
d2$anno_class<- "All"
d3<- rbind(d1, d2)
annos2<- unique(d3$anno_class)
d3$anno_class<- factor(d3$anno_class, levels = annos2)
col1 <- eval(substitute(x), d2)
d3$percent<- d3$perc*100
d3 %>%
ggplot(aes(x = percent, y=anno_class, fill = factor({{x}}))) +
geom_bar(stat="identity", width = 0.7, colour="black") +
theme_classic(base_size=32) +
#geom_vline(xintercept = (1-d2$perc[col1 == "Age-Hypermethylated"])*100, linetype = 'dashed') +
#geom_vline(xintercept = d2$perc[col1 == "Age-Hypomethylated"]*100, linetype = 'dashed') +
#theme(legend.position = "none") +
#scale_fill_manual(values = c(c1, c2, c3)) +
ylab("Annotation") +
xlab("Percentage")
}
generate_proportion(pqlseq_anno, direction)
View(test)
library(tidyverse)
library(ggplot2)
library(ggcorrplot)
library(ggvenn)
library(variancePartition)
library(lme4)
load("/scratch/ckelsey4/Cayo_meth/cross_within_compare.RData")
#Eq. 3
age_eq3_files<- 'wb_pqlseq2_eq3'
age_eq3_pqlseq<- import_pqlseq(age_eq3_files, y = 4)
#Import longitudinal pqlseq files
setwd('/scratch/ckelsey4/Cayo_meth/glmer_model_compare')
#Eq. 3
age_eq3_files<- 'wb_pqlseq2_eq3'
age_eq3_pqlseq<- import_pqlseq(age_eq3_files, y = 4)
age_eq3<- age_eq3_pqlseq %>%
select(c(outcome, beta, fdr))
colnames(age_eq3)<- c("outcome", "eq3_beta", "eq3_fdr")
age_w<- age_w_pqlseq  %>%
select(c(outcome, beta, fdr))
age_w<- age_w[age_w$outcome %in% age_eq3$outcome,]
age_w<- age_w_pqlseq  %>%
select(c(outcome, beta, fdr))
#Chronological Age
chron_age_files<- 'wb_pqlseq2_agechron'
chron_age_pqlseq<- import_pqlseq(chron_age_files, y = 4)
#Age Within
age_w_files<- 'wb_pqlseq2_within_age'
age_w_pqlseq<- import_pqlseq(age_w_files, y = 5)
#Mean Age
age_m_files<- 'wb_pqlseq2_mean_age'
age_m_pqlseq<- import_pqlseq(age_m_files, y = 5)
age_w<- age_w_pqlseq  %>%
select(c(outcome, beta, fdr))
colnames(age_w)<- c("outcome", "age_w_beta", "age_w_fdr")
age_w<- age_w[age_w$outcome %in% age_eq3$outcome,]
View(age_eq3)
#Eq2 vs Eq3--------------
age_eq3<- age_eq3_pqlseq %>%
select(c(outcome, beta, fdr)) %>%
mutate(eq = "eq3")
age_w<- age_w_pqlseq  %>%
select(c(outcome, beta, fdr)) %>%
mutate(eq = "eq2")
age_w<- age_w[age_w$outcome %in% age_eq3$outcome,]
age_compare<- rbind(age_w, age_eq3)
View(age_compare)
age_compare %>%
ggplot(aes(beta, fill = eq)) +
geom_histogram(alpha=0.5)
age_compare %>%
ggplot(aes(beta, fill = eq)) +
geom_histogram(alpha=0.5, position = position_dodge())
age_compare %>%
ggplot(aes(beta, fill = eq)) +
geom_density(alpha=0.5, position = position_dodge())
age_compare %>%
filter(fdr < 0.05) %>%
ggplot(aes(beta, fill = eq)) +
geom_density(alpha=0.5, position = position_dodge())
age_compare %>%
filter(fdr < 0.05) %>%
ggplot(aes(beta, fill = eq)) +
geom_density(alpha=0.5, position = position_dodge()) +
theme_classic(base_size=24)
library(tidyverse)
library(ggplot2)
library(ggcorrplot)
library(ggvenn)
library(variancePartition)
library(lme4)
load("/scratch/ckelsey4/Cayo_meth/cross_within_compare.RData")
######################################
###       Descriptive Stats        ###
######################################
#Cross-age age distribution
blood_metadata %>%
ggplot(aes(age_at_sampling, fill=individual_sex)) +
geom_histogram(position = "dodge", colour = "black") +
scale_x_continuous(breaks = seq(0, 30, by=5)) +
scale_fill_manual(values = c("steelblue1", "steelblue4"), name = "Sex") +
theme_classic(base_size=24) +
ylab("Count") +
xlab("Age")
#Longitudinal data distribution
long_data %>%
ggplot(aes(age_at_sampling, fill=individual_sex)) +
geom_histogram(position = "dodge", colour = "black") +
scale_x_continuous(breaks = seq(0, 30, by=5)) +
scale_fill_manual(values = c("purple", "purple4"), name = "Sex") +
theme_classic(base_size=24) +
ylab("Count") +
xlab("Age")
long_data %>%
ggplot(aes(mean.age, fill=individual_sex)) +
geom_histogram(position = "dodge", colour = "black") +
scale_x_continuous(breaks = seq(0, 30, by=5)) +
scale_fill_manual(values = c("purple", "purple4"), name = "Sex") +
theme_classic(base_size=24) +
ylab("Count") +
xlab("Age")
long_data %>%
ggplot(aes(mean.age, fill=individual_sex)) +
geom_histogram(position = "dodge", colour = "black") +
scale_x_continuous(breaks = seq(0, 30, by=5)) +
scale_fill_manual(values = c("purple", "purple4"), name = "Sex") +
theme_classic(base_size=24) +
ylab("Count") +
xlab("Mean Age")
ggsave("/home/ckelsey4/Cayo_meth/age_aging/cross_age.svg", plot = last_plot(),
width = 89, height = 89, units = "mm")
blood_metadata %>%
ggplot(aes(age_at_sampling, fill=individual_sex)) +
geom_histogram(position = "dodge", colour = "black") +
scale_x_continuous(breaks = seq(0, 30, by=5)) +
scale_fill_manual(values = c("steelblue1", "steelblue4"), name = "Sex") +
theme_classic(base_size=24) +
ylab("Count") +
xlab("Age")
ggsave("/home/ckelsey4/Cayo_meth/age_aging/cross_age.svg", plot = last_plot(),
width = 89, height = 89, units = "mm")
######################################
###       Descriptive Stats        ###
######################################
#Cross-age age distribution
blood_metadata %>%
ggplot(aes(age_at_sampling, fill=individual_sex)) +
geom_histogram(position = "dodge", colour = "black") +
scale_x_continuous(breaks = seq(0, 30, by=5)) +
scale_fill_manual(values = c("steelblue1", "steelblue4"), name = "Sex") +
theme_classic(base_size=24) +
ylab("Count") +
xlab("Age")
ggsave("/home/ckelsey4/Cayo_meth/age_aging/cross_age.svg", plot = last_plot(),
width = 89, height = 150, units = "mm")
ggsave("/home/ckelsey4/Cayo_meth/age_aging/cross_age.svg", plot = last_plot())
######################################
###       Descriptive Stats        ###
######################################
#Cross-age age distribution
blood_metadata %>%
ggplot(aes(age_at_sampling, fill=individual_sex)) +
geom_histogram(position = "dodge", colour = "black") +
scale_x_continuous(breaks = seq(0, 30, by=5)) +
scale_fill_manual(values = c("steelblue1", "steelblue4"), name = "Sex") +
theme_classic(base_size=12) +
ylab("Count") +
xlab("Age")
ggsave("/home/ckelsey4/Cayo_meth/age_aging/cross_age.svg", plot = last_plot())
######################################
###       Descriptive Stats        ###
######################################
#Cross-age age distribution
blood_metadata %>%
ggplot(aes(age_at_sampling, fill=individual_sex)) +
geom_histogram(position = "dodge", colour = "black") +
scale_x_continuous(breaks = seq(0, 30, by=5)) +
scale_fill_manual(values = c("steelblue1", "steelblue4"), name = "Sex") +
theme_classic(base_size=12) +
scale_y_continuous(breaks = seq(0, 30, 5)) +
ylab("Count") +
xlab("Age")
######################################
###       Descriptive Stats        ###
######################################
#Cross-age age distribution
blood_metadata %>%
ggplot(aes(age_at_sampling, fill=individual_sex)) +
geom_histogram(position = "dodge", colour = "black") +
scale_x_continuous(breaks = seq(0, 30, by=5)) +
scale_fill_manual(values = c("steelblue1", "steelblue4"), name = "Sex") +
theme_classic(base_size=12) +
scale_y_continuous(breaks = seq(0, 30, 5)) +
ylim(0, 30) +
ylab("Count") +
xlab("Age")
######################################
###       Descriptive Stats        ###
######################################
#Cross-age age distribution
blood_metadata %>%
ggplot(aes(age_at_sampling, fill=individual_sex)) +
geom_histogram(position = "dodge", colour = "black") +
scale_x_continuous(breaks = seq(0, 30, by=5)) +
scale_fill_manual(values = c("steelblue1", "steelblue4"), name = "Sex") +
theme_classic(base_size=12) +
scale_y_continuous(breaks = seq(0, 30, 5)) +
ylab("Count") +
xlab("Age")
######################################
###       Descriptive Stats        ###
######################################
#Cross-age age distribution
blood_metadata %>%
ggplot(aes(age_at_sampling, fill=individual_sex)) +
geom_histogram(position = "dodge", colour = "black") +
scale_x_continuous(breaks = seq(0, 30, by=5)) +
scale_fill_manual(values = c("steelblue1", "steelblue4"), name = "Sex") +
theme_classic(base_size=12) +
scale_y_continuous(breaks = seq(0, 30, 5)) +
coord_cartesian(ylim = (0, 30)) +
######################################
###       Descriptive Stats        ###
######################################
#Cross-age age distribution
blood_metadata %>%
ggplot(aes(age_at_sampling, fill=individual_sex)) +
geom_histogram(position = "dodge", colour = "black") +
scale_x_continuous(breaks = seq(0, 30, by=5)) +
scale_fill_manual(values = c("steelblue1", "steelblue4"), name = "Sex") +
theme_classic(base_size=12) +
scale_y_continuous(breaks = seq(0, 30, 5)) +
coord_cartesian(ylim = c(0, 30)) +
ylab("Count") +
xlab("Age")
#Longitudinal data distribution
long_data %>%
ggplot(aes(age_at_sampling, fill=individual_sex)) +
geom_histogram(position = "dodge", colour = "black") +
scale_x_continuous(breaks = seq(0, 30, by=5)) +
scale_y_continuous(breaks = seq(0, 30, 5)) +
coord_cartesian(ylim = c(0, 30)) +
scale_fill_manual(values = c("purple", "purple4"), name = "Sex") +
theme_classic(base_size=24) +
ylab("Count") +
xlab("Age")
#Longitudinal data distribution
long_data %>%
ggplot(aes(age_at_sampling, fill=individual_sex)) +
geom_histogram(position = "dodge", colour = "black") +
scale_x_continuous(breaks = seq(0, 30, by=5)) +
#scale_y_continuous(breaks = seq(0, 30, 5)) +
#coord_cartesian(ylim = c(0, 30)) +
scale_fill_manual(values = c("purple", "purple4"), name = "Sex") +
theme_classic(base_size=24) +
ylab("Count") +
xlab("Age")
#Longitudinal data distribution
long_data %>%
ggplot(aes(age_at_sampling, fill=individual_sex)) +
geom_histogram(position = "dodge", colour = "black") +
scale_x_continuous(breaks = seq(0, 30, by=5)) +
#scale_y_continuous(breaks = seq(0, 30, 5)) +
coord_cartesian(ylim = c(0, 30)) +
scale_fill_manual(values = c("purple", "purple4"), name = "Sex") +
theme_classic(base_size=24) +
ylab("Count") +
xlab("Age")
#Longitudinal data distribution
long_data %>%
ggplot(aes(age_at_sampling, fill=individual_sex)) +
geom_histogram(position = "dodge", colour = "black") +
scale_x_continuous(breaks = seq(0, 30, by=5)) +
scale_y_continuous(breaks = seq(0, 30, 5)) +
#coord_cartesian(ylim = c(0, 30)) +
scale_fill_manual(values = c("purple", "purple4"), name = "Sex") +
theme_classic(base_size=24) +
ylab("Count") +
xlab("Age")
#Longitudinal data distribution
long_data %>%
ggplot(aes(age_at_sampling, fill=individual_sex)) +
geom_histogram(position = "dodge", colour = "black") +
scale_x_continuous(breaks = seq(0, 20, by=5)) +
scale_y_continuous(breaks = seq(0, 20, 5)) +
#coord_cartesian(ylim = c(0, 30)) +
scale_fill_manual(values = c("purple", "purple4"), name = "Sex") +
theme_classic(base_size=24) +
ylab("Count") +
xlab("Age")
#Longitudinal data distribution
long_data %>%
ggplot(aes(age_at_sampling, fill=individual_sex)) +
geom_histogram(position = "dodge", colour = "black") +
scale_x_continuous(breaks = seq(0, 30, by=5)) +
scale_y_continuous(breaks = seq(0, 20, 5)) +
coord_cartesian(ylim = c(0, 20)) +
scale_fill_manual(values = c("purple", "purple4"), name = "Sex") +
theme_classic(base_size=24) +
ylab("Count") +
xlab("Age")
long_data %>%
ggplot(aes(mean.age, fill=individual_sex)) +
geom_histogram(position = "dodge", colour = "black") +
scale_x_continuous(breaks = seq(0, 30, by=5)) +
scale_y_continuous(breaks = seq(0, 30, 5)) +
coord_cartesian(ylim = c(0, 30)) +
scale_fill_manual(values = c("purple", "purple4"), name = "Sex") +
theme_classic(base_size=24) +
ylab("Count") +
xlab("Mean Age")
library(tidyverse)
ela_meta<- readRDS("/scratch/rpeter39/Cayo_pbmc/Cayo_PBMC_longLPS_metadata_wELA_18Jul25.rds")
ela_meta<- ela_meta %>%
filter(Stimulation == "H2O") %>%
select(c(animal_ID, sex, trapped_age, trapping_ID, Sample_ID, Seq_batch))
rna_meta<- readRDS("/home/ckelsey4/data/metadata_Ashlee.rds")
rna_meta<- rna_meta %>%
mutate(lid = rownames(rna_meta),
lid_pid = paste(lid, pid, sep = "_")) %>%
relocate(lid, .before = age) %>%
relocate(pid, .after = lid) %>%
relocate(lid_pid, .after = pid)
rna_meta<- rna_meta %>%
relocate(cayoid, .before = lid) %>%
rename(monkey_id = cayoid)
control_rna<- rna_meta %>%
select(-pid_stimulation) %>%
filter(stimulation == "cont")
control_rna<- control_rna %>%
group_by(monkey_id) %>%
mutate(n = n()) %>%
ungroup()
control_rna<- control_rna %>%
select(c(monkey_id, sex, age, trapid, rid, batch))
colnames(control_rna)<- colnames(ela_meta)
View(control_rna)
View(ela_meta)
control_rna$sex<- toupper(control_rna$sex)
View(rna_meta)
rna_meta %>% filter(monkey_id == '52Z')
rna_counts<- readRDS("/home/ckelsey4/data/counts_Ashlee.rds")
View(rna_counts)
compare<- full_join(control_rna, ela_meta, by = trapping_ID)
compare<- full_join(control_rna, ela_meta, by = trapping_ID)
compare<- full_join(control_rna, ela_meta)
View(compare)
compare2<- compare %>% group_by(animal_ID) %>% distinct(animal_ID, .keep_all = T)
View(compare2)
compare2<- mutate(n = n())
compare2<- group_by(animal_ID) %>% mutate(n = n()) filter(n > 1)
compare2<- compare2 %>% group_by(animal_ID) %>% mutate(n = n()) filter(n > 1)
compare2<- compare2 %>% group_by(animal_ID) %>% mutate(n = n()) %>% filter(n > 1)
rm(compare2)
ela_meta<- readRDS("/scratch/rpeter39/Cayo_pbmc/Cayo_PBMC_longLPS_metadata_wELA_18Jul25.rds")
View(ela_meta)
ela_meta<- ela_meta %>%
filter(Stimulation == "H2O") %>%
select(c(animal_ID, sex, trapped_age, trapping_ID, Sample_ID, Seq_batch))
View(rna_meta)
ela_meta %>% filter(trapped_ID == "T20120")
ela_meta %>% filter(trapping_ID == "T20120")
ela_meta %>% filter(animal_ID == "51Z")
