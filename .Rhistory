df$vars<- rownames(df)
df<- df %>%
pivot_wider(names_from = vars, values_from = c(beta, chi_square, pvalue, fdr))
df$Vu<- test[["Vu"]]
df$loglik<- test[["loglik"]]
df$Ve<- test[["Ve"]]
View(df)
colnames(df)
paste(colnames(df), sep = ", ")
length(rna_counts)
ncol(rna_counts)
rna_counts<- rna_counts[1:5, ]
View(rna_counts)
rna_counts<- readRDS("/home/ckelsey4/Cayo_meth/rna_seq/Cayo_PBMC_longLPS_counts_18Jul25.rds")
#Subset counts to RIDs in metadata
rna_counts<- t(rna_counts[, colnames(rna_counts) %in% rna_meta$Sample_ID])
rna_counts<- rna_counts[,1:5]
View(rna_counts)
colnames(rna_counts[, 1])
names(rna_counts[, 1])
View(rna_kin)
View(rna_counts)
colnames(rna_counts)
colnames(rna_counts)[1]
for (i in 1:ncol(rna_counts)) {
em<- emmreml(rna_counts[, i], predictor_matrix, re_matZ, rna_kin, varbetahat=T,varuhat=T, PEVuhat=T, test=T)
df<- as.data.frame(cbind(em[["betahat"]][1:4,], em[["Xsqtestbeta"]][1:4,],
em[["pvalbeta"]][1:4,8], em[["pvalbeta"]][1:4,7]))
colnames(df)<- c("beta", "chi_square", "pvalue", "fdr")
df$vars<- rownames(df)
df<- df %>%
pivot_wider(names_from = vars, values_from = c(beta, chi_square, pvalue, fdr))
df$Vu<- test[["Vu"]]
df$Ve<- test[["Ve"]]
df$loglik<- test[["loglik"]]
df$outcome<- colnames(rna_counts)[i]
df<- df %>%
relocate(outcome, .before=`beta_(Intercept)`)
df<- rbind(df, df[i,])
}
for (i in 1:ncol(rna_counts)) {
em<- emmreml(rna_counts[, i], predictor_matrix, re_matZ, rna_kin, varbetahat=T,varuhat=T, PEVuhat=T, test=T)
df<- as.data.frame(cbind(em[["betahat"]][1:4,], em[["Xsqtestbeta"]][1:4,],
em[["pvalbeta"]][1:4,8], em[["pvalbeta"]][1:4,7]))
colnames(df)<- c("beta", "chi_square", "pvalue", "fdr")
df$vars<- rownames(df)
df<- df %>%
pivot_wider(names_from = vars, values_from = c(beta, chi_square, pvalue, fdr))
df$Vu<- test[["Vu"]]
df$Ve<- test[["Ve"]]
df$loglik<- test[["loglik"]]
df$outcome<- colnames(rna_counts)[i]
df<- df %>%
relocate(outcome, .before=`beta_(Intercept)`)
df<- rbind(df, df[i,])
return(df)
}
View(df)
rm(df)
for (i in 1:ncol(rna_counts)) {
em<- emmreml(rna_counts[, i], predictor_matrix, re_matZ, rna_kin, varbetahat=T,varuhat=T, PEVuhat=T, test=T)
df<- as.data.frame(cbind(em[["betahat"]][1:4,], em[["Xsqtestbeta"]][1:4,],
em[["pvalbeta"]][1:4,8], em[["pvalbeta"]][1:4,7]))
colnames(df)<- c("beta", "chi_square", "pvalue", "fdr")
df$vars<- rownames(df)
df<- df %>%
pivot_wider(names_from = vars, values_from = c(beta, chi_square, pvalue, fdr))
df$Vu<- test[["Vu"]]
df$Ve<- test[["Ve"]]
df$loglik<- test[["loglik"]]
df$outcome<- colnames(rna_counts)[i]
df<- df %>%
relocate(outcome, .before=`beta_(Intercept)`)
df<- rbind(df, df[i,])
return(df)
}
View(df)
for (i in 1:ncol(rna_counts)) {print(i)}
df<- data.frame(matrix(nrow=0, ncol=20))
for (i in 1:ncol(rna_counts)) {
em<- emmreml(rna_counts[, i], predictor_matrix, re_matZ, rna_kin, varbetahat=T,varuhat=T, PEVuhat=T, test=T)
em_row<- as.data.frame(cbind(em[["betahat"]][1:4,], em[["Xsqtestbeta"]][1:4,],
em[["pvalbeta"]][1:4,8], em[["pvalbeta"]][1:4,7]))
colnames(em_row)<- c("beta", "chi_square", "pvalue", "fdr")
em_row$vars<- rownames(em_row)
em_row<- em_row %>%
pivot_wider(names_from = vars, values_from = c(beta, chi_square, pvalue, fdr))
em_row$Vu<- test[["Vu"]]
em_row$Ve<- test[["Ve"]]
em_row$loglik<- test[["loglik"]]
em_row$outcome<- colnames(rna_counts)[i]
em_row<- em_row %>%
relocate(outcome, .before=`beta_(Intercept)`)
df<- rbind(df, em_row)
return(df)
}
for (i in 1:ncol(rna_counts)) {
em<- emmreml(rna_counts[, i], predictor_matrix, re_matZ, rna_kin, varbetahat=T,varuhat=T, PEVuhat=T, test=T)
em_row<- as.data.frame(cbind(em[["betahat"]][1:4,], em[["Xsqtestbeta"]][1:4,],
em[["pvalbeta"]][1:4,8], em[["pvalbeta"]][1:4,7]))
colnames(em_row)<- c("beta", "chi_square", "pvalue", "fdr")
em_row$vars<- rownames(em_row)
em_row<- em_row %>%
pivot_wider(names_from = vars, values_from = c(beta, chi_square, pvalue, fdr))
em_row$Vu<- test[["Vu"]]
em_row$Ve<- test[["Ve"]]
em_row$loglik<- test[["loglik"]]
em_row$outcome<- colnames(rna_counts)[i]
em_row<- em_row %>%
relocate(outcome, .before=`beta_(Intercept)`)
df<- rbind(df, em_row)
}
View(df)
View(df)
df<- data.frame(matrix(nrow=0, ncol=20))
for (i in 1:ncol(rna_counts)) {
em<- emmreml(rna_counts[, i], predictor_matrix, re_matZ, rna_kin, varbetahat=T,varuhat=T, PEVuhat=T, test=T)
em_row<- as.data.frame(cbind(em[["betahat"]][1:4,], em[["Xsqtestbeta"]][1:4,],
em[["pvalbeta"]][1:4,8], em[["pvalbeta"]][1:4,7]))
colnames(em_row)<- c("beta", "chi_square", "pvalue", "fdr")
em_row$vars<- rownames(em_row)
em_row<- em_row %>%
pivot_wider(names_from = vars, values_from = c(beta, chi_square, pvalue, fdr))
em_row$Vu<- test[["Vu"]]
em_row$Ve<- test[["Ve"]]
em_row$loglik<- test[["loglik"]]
em_row$outcome<- colnames(rna_counts)[i]
em_row<- em_row %>%
relocate(outcome, .before=`beta_(Intercept)`)
df<- rbind(df, em_row)
}
View(df)
df<- data.frame(matrix(nrow=0, ncol=20))
for (i in 1:ncol(rna_counts)) {
em<- emmreml(rna_counts[, i], predictor_matrix, re_matZ, rna_kin, varbetahat=T,varuhat=T, PEVuhat=T, test=T)
em_row<- as.data.frame(cbind(em[["betahat"]][1:4,], em[["Xsqtestbeta"]][1:4,],
em[["pvalbeta"]][1:4,8], em[["pvalbeta"]][1:4,7]))
colnames(em_row)<- c("beta", "chi_square", "pvalue", "fdr")
em_row$vars<- rownames(em_row)
em_row<- em_row %>%
pivot_wider(names_from = vars, values_from = c(beta, chi_square, pvalue, fdr))
em_row$Vu<- em_row[["Vu"]]
em_row$Ve<- em_row[["Ve"]]
em_row$loglik<- em_row[["loglik"]]
em_row$outcome<- colnames(rna_counts)[i]
em_row<- em_row %>%
relocate(outcome, .before=`beta_(Intercept)`)
df<- rbind(df, em_row)
}
View(df)
df<- data.frame(matrix(nrow=0, ncol=20))
for (i in 1:ncol(rna_counts)) {
em<- emmreml(rna_counts[, i], predictor_matrix, re_matZ, rna_kin, varbetahat=T,varuhat=T, PEVuhat=T, test=T)
em_row<- as.data.frame(cbind(em[["betahat"]][1:4,], em[["Xsqtestbeta"]][1:4,],
em[["pvalbeta"]][1:4,8], em[["pvalbeta"]][1:4,7]))
colnames(em_row)<- c("beta", "chi_square", "pvalue", "fdr")
em_row$vars<- rownames(em_row)
em_row<- em_row %>%
pivot_wider(names_from = vars, values_from = c(beta, chi_square, pvalue, fdr))
em_row$Vu<- em[["Vu"]]
em_row$Ve<- em[["Ve"]]
em_row$loglik<- em[["loglik"]]
em_row$outcome<- colnames(rna_counts)[i]
em_row<- em_row %>%
relocate(outcome, .before=`beta_(Intercept)`)
df<- rbind(df, em_row)
}
View(df)
for (i in 1:ncol(rna_counts)) {
em<- emmreml(rna_counts[, i], predictor_matrix, re_matZ, rna_kin, varbetahat=T,varuhat=T, PEVuhat=T, test=T)
em_row<- as.data.frame(cbind(em[["betahat"]][1:4,], em[["Xsqtestbeta"]][1:4,],
em[["pvalbeta"]][1:4,8], em[["pvalbeta"]][1:4,7]))
colnames(em_row)<- c("beta", "chi_square", "pvalue", "fdr")
em_row$vars<- rownames(em_row)
em_row<- em_row %>%
pivot_wider(names_from = vars, values_from = c(beta, chi_square, pvalue, fdr))
em_row$Vu<- em[["Vu"]]
em_row$Ve<- em[["Ve"]]
em_row$loglik<- em[["loglik"]]
em_row$outcome<- colnames(rna_counts)[i]
em_row<- em_row %>%
relocate(outcome, .before=`beta_(Intercept)`)
df<- rbind(df, em_row)
}
View(rna_counts)
rna_counts<- readRDS("/home/ckelsey4/Cayo_meth/rna_seq/Cayo_PBMC_longLPS_counts_18Jul25.rds")
#Subset counts to RIDs in metadata
rna_counts<- t(rna_counts[, colnames(rna_counts) %in% rna_meta$Sample_ID])
for (i in 1:ncol(rna_counts)) {
em<- emmreml(rna_counts[, i], predictor_matrix, re_matZ, rna_kin, varbetahat=T,varuhat=T, PEVuhat=T, test=T)
em_row<- as.data.frame(cbind(em[["betahat"]][1:4,], em[["Xsqtestbeta"]][1:4,],
em[["pvalbeta"]][1:4,8], em[["pvalbeta"]][1:4,7]))
colnames(em_row)<- c("beta", "chi_square", "pvalue", "fdr")
em_row$vars<- rownames(em_row)
em_row<- em_row %>%
pivot_wider(names_from = vars, values_from = c(beta, chi_square, pvalue, fdr))
em_row$Vu<- em[["Vu"]]
em_row$Ve<- em[["Ve"]]
em_row$loglik<- em[["loglik"]]
em_row$outcome<- colnames(rna_counts)[i]
em_row<- em_row %>%
relocate(outcome, .before=`beta_(Intercept)`)
df<- rbind(df, em_row)
}
rna_counts<- rna_counts[, 1:10]
df<- data.frame(matrix(nrow=0, ncol=20))
for (i in 1:ncol(rna_counts)) {
em<- emmreml(rna_counts[, i], predictor_matrix, re_matZ, rna_kin, varbetahat=T,varuhat=T, PEVuhat=T, test=T)
em_row<- as.data.frame(cbind(em[["betahat"]][1:4,], em[["Xsqtestbeta"]][1:4,],
em[["pvalbeta"]][1:4,8], em[["pvalbeta"]][1:4,7]))
colnames(em_row)<- c("beta", "chi_square", "pvalue", "fdr")
em_row$vars<- rownames(em_row)
em_row<- em_row %>%
pivot_wider(names_from = vars, values_from = c(beta, chi_square, pvalue, fdr))
em_row$Vu<- em[["Vu"]]
em_row$Ve<- em[["Ve"]]
em_row$loglik<- em[["loglik"]]
em_row$outcome<- colnames(rna_counts)[i]
em_row<- em_row %>%
relocate(outcome, .before=`beta_(Intercept)`)
df<- rbind(df, em_row)
print(paste("Gene", i, "out of", ncol(rna_counts), "done!", sep=" "))
}
library(tidyverse)
library(EMMREML)
library(lme4)
rna_meta<- readRDS("/home/ckelsey4/Cayo_meth/rna_seq/Cayo_PBMC_longLPS_metadata_wELA_18Jul25.rds")
rna_counts<- readRDS("/home/ckelsey4/Cayo_meth/rna_seq/Cayo_PBMC_longLPS_counts_18Jul25.rds")
rna_kin<- readRDS("/scratch/ckelsey4/Cayo_meth/rna_kin_matrix.rds")
#Subset to control and truncate df to relevant variables
rna_meta<- rna_meta %>%
filter(Stimulation == "H2O") %>%
select(c(animal_ID, sex, trapped_age, trapping_ID, Sample_ID, Seq_batch))
#Generate within and between age
rna_meta<- rna_meta %>%
group_by(animal_ID) %>%
mutate(mean_age = mean(trapped_age)) %>%
mutate(within_age = trapped_age - mean_age) %>%
arrange(animal_ID, trapped_age)
#Make batch factor
rna_meta$Seq_batch<- gsub("batch", "", rna_meta$Seq_batch)
rna_meta$Seq_batch<- factor(rna_meta$Seq_batch, levels = c("1", "2", "3"))
#Subset counts to RIDs in metadata
rna_counts<- t(rna_counts[, colnames(rna_counts) %in% rna_meta$Sample_ID])
#Generate model matrix
predictor_matrix<- model.matrix(~ within_age + mean_age + sex + Seq_batch, data = rna_meta)
re_eq = "y ~ within_age + mean_age + sex + Seq_batch + (1|animal_ID)"
rna_meta$y<- 1
#This generates a random intercept matrix with dims 309 x 114
re_mat <- lFormula(eval(re_eq), rna_meta)
re_matZ <- as.matrix(t(re_mat$reTrms$Zt))
df<- data.frame(matrix(nrow=0, ncol=20))
for (i in 1:ncol(rna_counts)) {
em<- emmreml(rna_counts[, i], predictor_matrix, re_matZ, rna_kin, varbetahat=T,varuhat=T, PEVuhat=T, test=T)
em_row<- as.data.frame(cbind(em[["betahat"]][1:4,], em[["Xsqtestbeta"]][1:4,],
em[["pvalbeta"]][1:4,8], em[["pvalbeta"]][1:4,7]))
colnames(em_row)<- c("beta", "chi_square", "pvalue", "fdr")
em_row$vars<- rownames(em_row)
em_row<- em_row %>%
pivot_wider(names_from = vars, values_from = c(beta, chi_square, pvalue, fdr))
em_row$Vu<- em[["Vu"]]
em_row$Ve<- em[["Ve"]]
em_row$loglik<- em[["loglik"]]
em_row$outcome<- colnames(rna_counts)[i]
em_row<- em_row %>%
relocate(outcome, .before=`beta_(Intercept)`)
df<- rbind(df, em_row)
print(paste("Gene", i, "out of", ncol(rna_counts), "done!", sep=" "))
}
predictor_matrix<- model.matrix(~ trapped_age + sex + Seq_batch, data = rna_meta)
re_eq = "y ~ trapped_age + sex + Seq_batch + (1|animal_ID)"
rna_meta$y<- 1
#This generates a random intercept matrix with dims 309 x 114
re_mat <- lFormula(eval(re_eq), rna_meta)
re_matZ <- as.matrix(t(re_mat$reTrms$Zt))
df_chron<- data.frame(matrix(nrow=0, ncol=20))
for (i in 1:ncol(rna_counts)) {
em<- emmreml(rna_counts[, i], predictor_matrix, re_matZ, rna_kin, varbetahat=T,varuhat=T, PEVuhat=T, test=T)
em_row<- as.data.frame(cbind(em[["betahat"]][1:4,], em[["Xsqtestbeta"]][1:4,],
em[["pvalbeta"]][1:4,8], em[["pvalbeta"]][1:4,7]))
colnames(em_row)<- c("beta", "chi_square", "pvalue", "fdr")
em_row$vars<- rownames(em_row)
em_row<- em_row %>%
pivot_wider(names_from = vars, values_from = c(beta, chi_square, pvalue, fdr))
em_row$Vu<- em[["Vu"]]
em_row$Ve<- em[["Ve"]]
em_row$loglik<- em[["loglik"]]
em_row$outcome<- colnames(rna_counts)[i]
em_row<- em_row %>%
relocate(outcome, .before=`beta_(Intercept)`)
df_chron<- rbind(df_chron, em_row)
print(paste("Gene", i, "out of", ncol(rna_counts), "done!", sep=" "))
}
save.image("home/ckelsey4/Cayo_meth/rna_compare.RData")
save.image("/home/ckelsey4/Cayo_meth/rna_compare.RData")
df %>%
ggplot(aes(pvalue_within_age)) +
geom_histogram(bins=30) +
theme_classic(base_size=12)
df %>%
ggplot(aes(pvalue_within_age)) +
geom_histogram(bins=30, colour=black) +
theme_classic(base_size=12)
df %>%
ggplot(aes(pvalue_within_age)) +
geom_histogram(bins=30, colour="black") +
theme_classic(base_size=12)
df %>%
pivot_longer(cols=c(pvalue_within_age, pvalue_mean_age),
values_to = "pval ",
names_to = "term") %>%
ggplot(aes(pval, fill = term)) +
geom_histogram(bins=30, colour="black") +
theme_classic(base_size=12)
df %>%
pivot_longer(cols=c(pvalue_within_age, pvalue_mean_age),
values_to = "pval ",
names_to = "term")
df %>%
select(c(pvalue_within_age, pvalue_mean_age)) %>%
pivot_longer(cols=c(pvalue_within_age, pvalue_mean_age),
values_to = "pval ",
names_to = "term")
df %>%
select(c(pvalue_within_age, pvalue_mean_age)) %>%
pivot_longer(cols=c(pvalue_within_age, pvalue_mean_age),
values_to = "pval ",
names_to = "term") %>%
ggplot(aes(pval, fill = term)) +
geom_histogram(bins=30, colour="black") +
theme_classic(base_size=12)
df %>%
select(c(pvalue_within_age, pvalue_mean_age)) %>%
pivot_longer(cols=c(pvalue_within_age, pvalue_mean_age),
values_to = "pval",
names_to = "term") %>%
ggplot(aes(pval, fill = term)) +
geom_histogram(bins=30, colour="black") +
theme_classic(base_size=12)
df %>%
select(c(pvalue_within_age, pvalue_mean_age)) %>%
pivot_longer(cols=c(pvalue_within_age, pvalue_mean_age),
values_to = "pval",
names_to = "term") %>%
ggplot(aes(pval, fill = term)) +
geom_histogram(bins=30, colour="black", position = position_dodge2()) +
theme_classic(base_size=12)
df %>%
select(c(pvalue_within_age, pvalue_mean_age)) %>%
pivot_longer(cols=c(pvalue_within_age, pvalue_mean_age),
values_to = "pval",
names_to = "term") %>%
ggplot(aes(pval, fill = term)) +
geom_histogram(bins=30, colour="black", position = position_dodge()) +
theme_classic(base_size=12)
df_chron %>%
ggplot(aes(pvalue_trapped_age)) +
geom_histogram(bins=30, colour='black') +
theme_classic(base_size=12)
library(tidyverse)
library(EMMREML)
library(lme4)
library(ggplot2)
library(variancePartition)
load("/home/ckelsey4/Cayo_meth/rna_compare.RData")
predictor_matrix<- model.matrix(~ trapped_age + mean_age + sex + Seq_batch, data = rna_meta)
re_eq = "y ~ trapped_age + mean_age + sex + Seq_batch + (1|animal_ID)"
rna_meta$y<- 1
#This generates a random intercept matrix with dims 309 x 114
re_mat <- lFormula(eval(re_eq), rna_meta)
re_matZ <- as.matrix(t(re_mat$reTrms$Zt))
df_eq3<- data.frame(matrix(nrow=0, ncol=20))
for (i in 1:ncol(rna_counts)) {
em<- emmreml(rna_counts[, i], predictor_matrix, re_matZ, rna_kin, varbetahat=T,varuhat=T, PEVuhat=T, test=T)
em_row<- as.data.frame(cbind(em[["betahat"]][1:4,], em[["Xsqtestbeta"]][1:4,],
em[["pvalbeta"]][1:4,8], em[["pvalbeta"]][1:4,7]))
colnames(em_row)<- c("beta", "chi_square", "pvalue", "fdr")
em_row$vars<- rownames(em_row)
em_row<- em_row %>%
pivot_wider(names_from = vars, values_from = c(beta, chi_square, pvalue, fdr))
em_row$Vu<- em[["Vu"]]
em_row$Ve<- em[["Ve"]]
em_row$loglik<- em[["loglik"]]
em_row$outcome<- colnames(rna_counts)[i]
em_row<- em_row %>%
relocate(outcome, .before=`beta_(Intercept)`)
df_eq3<- rbind(df_eq3, em_row)
print(paste("Gene", i, "out of", ncol(rna_counts), "done!", sep=" "))
}
df_eq3 %>%
ggplot(aes(pvalue_trapped_age)) +
geom_histogram(bins=30, colour='black') +
theme_classic(base_size=12)
df_eq3 %>%
select(c(pvalue_trapped_age, pvalue_mean_age)) %>%
pivot_longer(cols=c(pvalue_trapped_age, pvalue_mean_age),
values_to = "pval",
names_to = "term") %>%
ggplot(aes(pval, fill = term)) +
geom_histogram(bins=30, colour="black", position = position_dodge()) +
theme_classic(base_size=12)
View(df_eq3)
View(df_chron)
#Run EMMA for within_age-------------------------------------------------------------
#Generate model matrix
predictor_matrix<- model.matrix(~ within_age + mean_age + sex + Seq_batch, data = rna_meta)
predictor_matrix<- model.matrix(~ trapped_age + mean_age + sex, data = rna_meta)
re_eq = "y ~ trapped_age + mean_age + sex + (1|animal_ID)"
rna_meta$y<- 1
#This generates a random intercept matrix with dims 309 x 114
re_mat <- lFormula(eval(re_eq), rna_meta)
re_matZ <- as.matrix(t(re_mat$reTrms$Zt))
df_eq3<- data.frame(matrix(nrow=0, ncol=20))
for (i in 1:ncol(rna_counts)) {
em<- emmreml(rna_counts[, i], predictor_matrix, re_matZ, rna_kin, varbetahat=T,varuhat=T, PEVuhat=T, test=T)
em_row<- as.data.frame(cbind(em[["betahat"]][1:3,], em[["Xsqtestbeta"]][1:3,],
em[["pvalbeta"]][1:3,8], em[["pvalbeta"]][1:3,7]))
colnames(em_row)<- c("beta", "chi_square", "pvalue", "fdr")
em_row$vars<- rownames(em_row)
em_row<- em_row %>%
pivot_wider(names_from = vars, values_from = c(beta, chi_square, pvalue, fdr))
em_row$Vu<- em[["Vu"]]
em_row$Ve<- em[["Ve"]]
em_row$loglik<- em[["loglik"]]
em_row$outcome<- colnames(rna_counts)[i]
em_row<- em_row %>%
relocate(outcome, .before=`beta_(Intercept)`)
df_eq3<- rbind(df_eq3, em_row)
print(paste("Gene", i, "out of", ncol(rna_counts), "done!", sep=" "))
}
View(em_row)
em<- emmreml(rna_counts[, 1], predictor_matrix, re_matZ, rna_kin, varbetahat=T,varuhat=T, PEVuhat=T, test=T)
View(em)
em[["pvalu"]]
em[["pvalbeta"]]
em[["pvalbeta"]][1:4,8]
em_row<- as.data.frame(cbind(em[["betahat"]][1:4,], em[["Xsqtestbeta"]][1:4,],
em[["pvalbeta"]][1:4,8], em[["pvalbeta"]][1:4,7]))
View(em_row)
colnames(em_row)<- c("beta", "chi_square", "pvalue", "fdr")
em_row$vars<- rownames(em_row)
em_row<- em_row %>%
pivot_wider(names_from = vars, values_from = c(beta, chi_square, pvalue, fdr))
df %>%
select(c(fdr_within_age, fdr_mean_age)) %>%
pivot_longer(cols=c(fdr_within_age, fdr_mean_age),
values_to = "pval",
names_to = "term") %>%
ggplot(aes(pval, fill = term)) +
geom_histogram(bins=30, colour="black", position = position_dodge()) +
theme_classic(base_size=12)
df_eq3 %>%
select(c(fdr_trapped_age, fdr_mean_age)) %>%
pivot_longer(cols=c(fdr_trapped_age, fdr_mean_age),
values_to = "pval",
names_to = "term") %>%
ggplot(aes(pval, fill = term)) +
geom_histogram(bins=30, colour="black", position = position_dodge()) +
theme_classic(base_size=12)
predictor_matrix<- model.matrix(~ trapped_age + mean_age + sex, data = rna_meta)
re_eq = "y ~ trapped_age + mean_age + sex + (1|animal_ID)"
rna_meta$y<- 1
#This generates a random intercept matrix with dims 309 x 114
re_mat <- lFormula(eval(re_eq), rna_meta)
re_matZ <- as.matrix(t(re_mat$reTrms$Zt))
em<- emmreml(rna_counts[, 1], predictor_matrix, re_matZ, rna_kin, varbetahat=T,varuhat=T, PEVuhat=T, test=T)
em_row<- as.data.frame(cbind(em[["betahat"]][1:4,], em[["Xsqtestbeta"]][1:4,],
em[["pvalbeta"]][1:4,8], em[["pvalbeta"]][1:4,7]))
em<- emmreml(rna_counts[, i], predictor_matrix, re_matZ, rna_kin, varbetahat=T,varuhat=T, PEVuhat=T, test=T)
em_row2<- as.data.frame(cbind(em[["betahat"]][1:4,], em[["Xsqtestbeta"]][1:4,],
em[["pvalbeta"]][1:4,"none"], em[["pvalbeta"]][1:4,"fdr"]))
View(em_row2)
em_row<- as.data.frame(cbind(em[["betahat"]][1:4,], em[["Xsqtestbeta"]][1:4,],
em[["pvalbeta"]][1:4,8], em[["pvalbeta"]][1:4,7]))
em_row<- as.data.frame(cbind(em[["betahat"]][1:4,], em[["Xsqtestbeta"]][1:4,],
em[["pvalbeta"]][1:4,"none"], em[["pvalbeta"]][1:4,"fdr"]))
em[["pvalbeta"]]
colnames(em_row)<- c("beta", "chi_square", "pvalue", "fdr")
colnames(em_row)<- c("beta", "chi_square", "pvalue", "fdr")
View(em_row)
#load packages
library(bsseq)
library(comethyl)
library(tidyverse)
library(Biostrings)
library(GenomicFeatures)
library(GenomicRanges)
#set working directory
setwd("/scratch/ckelsey4/Cayo_meth/")
###################################
#####       Load Data         #####
###################################
#Import metadata
blood_metadata<- read.table("blood_metadata_full.txt")
cayo_blood_list<- readRDS("cayo_blood_full.rds")
View(cayo_blood_list)
cayo_blood_list[["1"]]
View(cayo_blood_list)
prom_m_filtered<- readRDS("prom_m_filtered.rds")
setwd("/scratch/ckelsey4/Cayo_meth/")
prom_m_filtered<- readRDS("prom_m_filtered.rds")
prom_cov_filtered<- saveRDS("prom_cov_filtered")
prom_m_filtered<- readRDS("prom_m_filtered.rds")
prom_m_filtered<- readRDS("prom_m_filtered")
prom_cov_filtered<- readRDS("prom_cov_filtered")
View(prom_m_filtered)
prom_m_filtered[["1"]]
chrom_1_m<- prom_m_filtered[["1"]]
View(chrom_1_m)
View(prom_cov_filtered)
chrom_1_cov<- prom_cov_filtered[["1"]]
View(chrom_1_cov)
